/* InfiniScroll - (09 october 2021) - https://github.com/ronny/infiniscroll/ | MIT License */
/* forked from: https://github.com/Elkfox/Ajaxinate */
var __awaiter=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function c(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(a,c)}l((i=i.apply(e,n||[])).next())})};export function InfiniScroll(e){var n;const t=Object.assign(Object.assign({},{itemsContainerSelector:"#InfiniScrollItemsContainer",paginationContainerSelector:"#InfiniScrollPaginationContainer",offset:0,loadingText:"Loadingâ€¦",debug:!1}),e),i=t.debug?null!==(n=t.logger)&&void 0!==n?n:console:{error(){}},o=document.querySelector(t.itemsContainerSelector),r=document.querySelector(t.paginationContainerSelector),a=new window.DOMParser;return{start:c,stop:function(){return __awaiter(this,void 0,void 0,function*(){l()})}};function c(){return __awaiter(this,void 0,void 0,function*(){o?r?function(){if(!r)return;document.addEventListener("scroll",s,{passive:!0}),window.addEventListener("resize",s,{passive:!0}),window.addEventListener("orientationchange",s,{passive:!0})}():i.error(`InfiniScroll paginationContainerSelector ${t.paginationContainerSelector} does not match any element`):i.error(`InfiniScroll itemsContainerSelector ${t.itemsContainerSelector} does not match any element`)})}function l(){document.removeEventListener("scroll",s),window.removeEventListener("resize",s),window.removeEventListener("orientationchange",s)}function s(){if(!r)return;const e=r.getBoundingClientRect(),n=e.top-t.offset,s=e.bottom+t.offset;if(n<=window.innerHeight&&s>=0){const e=r.querySelector("a");l(),e&&(e.innerText=t.loadingText,function(e){__awaiter(this,void 0,void 0,function*(){if(!o||!r)return;const n=yield fetch(e,{method:"GET",credentials:"same-origin",keepalive:!0,redirect:"follow",headers:{Accept:"text/html"}});if(!n.ok)return void i.error("InfiniScroll: loadNextPage: ",n.status,n.statusText);const s=a.parseFromString(yield n.text(),"text/html"),d=s.querySelectorAll(t.itemsContainerSelector)[0];if(!d)return void i.error(`InfiniScroll: loadNextPage: next page has no items container matching selector ${t.itemsContainerSelector}`);o.insertAdjacentHTML("beforeend",d.innerHTML);const u=s.querySelectorAll(t.paginationContainerSelector)[0];u?(r.innerHTML=u.innerHTML,c()):(r.innerHTML="",l())})}(e.href))}}};